<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="skin.main_template.macros.master">
  <head>
    <metal:block metal:fill-slot="head_slot">
      <script src="${sref('jugendkongress/uiblocker.js')}"></script>
      <script src="${sref('admin/admin.js')}"></script>
    </metal:block>
  </head>
  
  <body>
    <metal:block metal:fill-slot="congress-menu">
      <metal:block use-macro="skin.main_template.macros.admin_menu" />
    </metal:block>
    
    <div metal:fill-slot="main" class="mt-4">
      <div class="my-3 title">
        <h3 style="display: inline">
          Buchungen ${congress.year}
        </h3>
        <label class="ms-3">
          <input type="checkbox" value="kontakt" />
          e-Kontakt
        </label>
        <label class="ms-3">
          <input type="checkbox" />
          Adresse
        </label>
        <label class="ms-3">
          <input type="checkbox" />
          Zimmer
        </label>
        <label class="ms-3">
          <input type="checkbox" />
          Essen
        </label>        
        <label class="ms-3">
          <input type="checkbox" value="misc" />
          Anreise, Musik
        </label>
        <label class="ms-3">
          <input type="checkbox" />
          Rolle
        </label>
        <label class="ms-3">
          <input type="checkbox" />
          Bemerkungen
        </label>
      </div>
      
      <table class="table users">
        <thead>
          <tr>
            <th></th>
            <th>Name, Login</th>
            <tal:block tal:condition="'kontakt' in active_colsets">
              <th>e-Mail, Telefon</th>
              <th>Geboren, (<small>Alter beim Kongress</small>)</th>
            </tal:block>
            <tal:block tal:condition="'adresse' in active_colsets">
              <th>Adresse</th>
            </tal:block>
            <tal:block tal:condition="'zimmer' in active_colsets">
              <th colspan="3">Zimmer</th>
              <th>Zimmerpartner</th>
            </tal:block>
            <tal:block tal:condition="'essen' in active_colsets">
              <th>Essen</th>
            </tal:block>
            <tal:block tal:condition="'essen' in active_colsets">
              <th>Anreise</th>
              <th>Musik</th>
            </tal:block>
            <tal:block tal:condition="'rolle' in active_colsets">
              <th>Rolle</th>
            </tal:block>
            <tal:block tal:condition="'bemerkungen' in active_colsets">
              <th colspan="1">
                Bemerkungen
              </th>
            </tal:block>
          </tr>
        </thead>
        
        <tbody class="filters text-secondary"
               tal:condition="'rolle' in active_colsets or 'misc' in active_colsets">
          <tr>
            <th></th><!--Role marker-->
            <th class="align-middle text-secondary">
              <!--Name, Login-->
              Filter
              <button class="btn btn-primary btn-tiny reset">
                ❌ Zurücksetzen
              </button>
            </th>
            <tal:block tal:condition="'kontakt' in active_colsets">
              <th></th><!--e-Mail, Telefon-->
              <th></th>
            </tal:block>
            
            <tal:block tal:condition="'adresse' in active_colsets">
              <th></th><!--Adresse-->
            </tal:block>
            
            <tal:block tal:condition="'zimmer' in active_colsets">
              <th colspan="3"><!--Zimmer-->
                <label class="form-label">
                  <input type="checkbox" value="on"
                         data-filter-name="room_overwrite"/>
                  Manuell
                </label>
              </th>                
              <th></th><!--Zimmerpartner-->
            </tal:block>
            
            <tal:block tal:condition="'essen' in active_colsets">
              <th></th><!--Essen-->
            </tal:block>
            
            <tal:block tal:condition="'misc' in active_colsets">
              <th><!--Anreise-->
                <select class="form-select ${filter.anreise}"
                        data-filter-name="anreise">
                  <option></option>
                  <option tal:attributes="selected
                                ptutils.selected(filter.anreise == 'suche')"
                          value="attendee">
                    suche
                  </option>
                  <option tal:attributes="selected
                               ptutils.selected(filter.anreise == 'biete')"
                          value="team">
                    biete
                  </option>
                </select>
                
              </th>
              <th class="align-middle text-nowrap"><!--Musik-->
                <label class="form-label">
                  <input type="checkbox" value="on"
                         data-filter-name="musik"/>
                  Angaben
                </label>
              </th>
            </tal:block>
            
            <tal:block tal:condition="'rolle' in active_colsets">
              <th><!--Rolle-->
                <select class="filter form-select ${filter.role}"
                        data-filter-name="role">
                  <option value="">Alle</option>
                  <option tal:attributes="selected
                                ptutils.selected(filter.role == 'attendee')"
                          value="attendee">
                    Teilnehmer
                  </option>
                  <option tal:attributes="selected
                               ptutils.selected(filter.role == 'team')"
                          value="team">
                    Team
                  </option>
                  <option tal:attributes="selected
                                ptutils.selected(filter.role == 'speaker')"
                          value="speaker">
                    Workshopleiter
                  </option>
                </select>
              </th>
            </tal:block>
            <tal:block tal:condition="'bemerkungen' in active_colsets">
              <th><!--remarks-->
                <label class="form-label">
                  <input type="checkbox" value="on"
                         data-filter-name="remarks"/>
                  Angaben
                </label>
              </th>
            </tal:block>
            <th><!--buttons-->
            </th>
          </tr>
        </tbody>
        
        <tbody class="table-striped">
          <tal:block tal:repeat="b bookings">
            <tr data-id="${b.id}">
              <td class="role ${b.role}"></td>
              <td>
                <div class="text-nowrap ${test(not b.completed,
                                               'text-danger')}">
                  <span tal:content="b.firstname"/>
                  <strong tal:content="b.lastname"
                          /> <a href="/admin/booking_name_form.py?id=${b.id}"
                                class="text-decoration-none">✎</a>
                </div>
                <div tal:condition="b.completed">
                  <small>
                    aus ${b.city}
                  </small>
                </div>
                <div class="text-danger" tal:condition="not:b.completed">
                  Anmeldung noch unvollständig!
                </div>
              </td>
              
              <tal:block tal:condition="'kontakt' in active_colsets">
                <td>
                  <div>
                    <a href="string:mailto:${b.email}" tal:content="b.email" />
                  </div>
                  <div class="pt-1" tal:condition="b.phone">
                    ☎ <a href="tel:${b.phone}">${b.phone}</a>
                  </div>
                </td>
                <td tal:define="age b.age_then">
                  ${ptutils.pretty_german_date(b.dob)}
                  
                  <small tal:condition="age"
                         class="${test(age &lt; 18,
                                'text-danger',
                                'text-success')}"
                         style="font-weight: bold">
                    (${b.age_then})
                  </small>
                </td>
              </tal:block>

              <tal:block tal:condition="'adresse' in active_colsets">
                <td>
                  <div class="text-nowrap" tal:content="b.address" />
                  <div>${b.zip} ${b.city}</div>
                </td>
              </tal:block>
              
              <tal:block tal:condition="'zimmer' in active_colsets">
                <td class="text-nowrap"
                    tal:content="structure b.room_preference_html"></td>
                <td>${b.gender_symbol}</td>
                <td class="text-nowrap">
                  <span class="room ${test(b.room_overwrite, 'overwritten')}"
                        tal:content="b.ROOM">
                  </span>
                  <a href="#" style="text-decoration: none"
                     class="ms-3 room-overwrite-link">✎</a>
                </td>
                <td tal:content="structure b.room_mates_html" />
              </tal:block>
              
              <tal:block tal:condition="'essen' in active_colsets">
                <!--Essen-->
                <td>
                  <div class="text-bold">
                    ${b.food_preference_html}
                  </div>
                </td>                
              </tal:block>
              
              <tal:block tal:condition="'misc' in active_colsets">
                <td class="ride-sharing-${b.ride_sharing_option}">
                  <tal:block tal:condition="b.ride_sharing_option == 'offer'">
                    biete
                  </tal:block>
                  <tal:block tal:condition="b.ride_sharing_option == 'seek'">
                    suche
                  </tal:block>
                  <div tal:condition="b.ride_sharing_option != 'none'">
                    <strong tal:content="b.ride_sharing_start" />
                  </div>
                </td>
                
                <td tal:content="b.musical_instrument">
                </td>
              </tal:block>

              <tal:block tal:condition="'rolle' in active_colsets">
                <td>
                  <select class="role form-select ${b.role}">
                    <option tal:attributes="selected
                                    ptutils.selected(b.role == 'attendee')"
                            value="attendee">
                      Teilnehmer
                    </option>
                    <option tal:attributes="selected
                                    ptutils.selected(b.role == 'team')"
                            value="team">
                      Team
                    </option>
                    <option tal:attributes="selected
                                    ptutils.selected(b.role == 'speaker')"
                            value="speaker">
                      Workshopleiter
                    </option>
                  </select>
                </td>
              </tal:block>

              <td tal:condition="'bemerkungen' in active_colsets">
                <div tal:condition="b.remarks"
                     class="text-danger small"
                     tal:content="b.remarks" />
              </td>
              <td><!--Buttons-->
                <a href="${b.href}" class="btn btn-sm btn-primary"
                   target="_new">
                  <img src="/skin/admin/pen.svg" />                  
                </a>
              </td>              
            </tr>
          </tal:block>
        </tbody>
        <tr>
          <td></td><!--role-->
          <td><!--name-->
            ${len(bookings)} Anmeldungen
            <div tal:replace="structure gender_info_html">
            </div>
          </td>
          <tal:block tal:condition="'kontakt' in active_colsets">
            <td><!--Kontakt--></td>
            <td><!--dob&alter--></td>
          </tal:block>
          <tal:block tal:condition="'zimmer' in active_colsets">
            <td colspan="4"><!--Zimmer-->
            </td>
          </tal:block>
          <tal:block tal:condition="'essen' in active_colsets">
            <td tal:content="food_preference_html"><!--Essen-->            
            </td>
          </tal:block>
          <tal:block tal:condition="'misc' in active_colsets">
            <td></td>
            <td></td>
          </tal:block>
          <tal:block tal:condition="'rolle' in active_colsets">
            <td>
              <table class="role-counts">
                <tbody>
                  <tr>
                    <td class="count">${role_counts.get('team', 0)}</td>
                    <td>Team</td>
                  </tr>
                  <tr>
                    <td class="count">${role_counts.get('speaker', 0)}</td>
                    <td>Workshopleiter</td>
                  </tr>
                  <tr>
                    <td class="count">${role_counts.get('attendee', 0)}</td>
                    <td>Teilnehmer</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tal:block>
          
          <td><!--remarks-->
          </td>
          <td><!--buttons-->
          </td>
        </tr>
      </table>
    </div>
  </body>
</html>
